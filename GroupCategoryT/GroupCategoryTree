const GroupCategoryTree: React.FC<GroupCategoryTreeProps> = ({
  categories,
  onRemoveGroup,
}) => {
  const classes = useStyles();

  const tree = useMemo(
    () => buildTreeFromCategories(categories),
    [categories],
  );

  const renderNodes = (
    nodes: TreeNode[],
    depth = 0,
    isLastArray: boolean[] = [],
  ): React.ReactNode =>
    nodes.map((node, index) => {
      const isLast = index === nodes.length - 1;
      const thisIsLastArray = [...isLastArray, isLast];

      // Build ASCII prefix exactly like before
      let prefix = '';
      if (depth > 0) {
        for (let i = 0; i < depth - 1; i++) {
          // keep your top-column tweak here if you added it
          prefix += thisIsLastArray[i] ? '   ' : '│  ';
        }
        prefix += isLast ? '└─ ' : '├─ ';
      }

      const isLeafGroup =
        node.isGroup &&
        node.category &&
        (!node.children || node.children.length === 0);

      return (
        <React.Fragment key={node.fullPath}>
          <div className={classes.treeRow}>
            {/* column 1: ASCII tree text (fixed width) */}
            <span
              className={classes.treeText}
              style={{ fontWeight: depth === 0 ? 'bold' : 'normal' }}
            >
              {prefix}
              {node.name}
            </span>

            {/* column 2: horizontal line only for leaf groups */}
            {isLeafGroup ? (
              <div className={classes.treeLine} />
            ) : (
              <div /> // empty to keep grid alignment
            )}

            {/* column 3: delete icon only for leaf groups */}
            {isLeafGroup && onRemoveGroup ? (
              <IconButton
                size="small"
                style={{ padding: 4 }}
                onClick={() => onRemoveGroup(node.category!, node.fullPath)}
              >
                <DeleteIcon fontSize="small" />
              </IconButton>
            ) : (
              <span /> // empty cell to keep columns aligned
            )}
          </div>

          {renderNodes(node.children, depth + 1, thisIsLastArray)}
        </React.Fragment>
      );
    });

  return <div>{renderNodes(tree)}</div>;
};
