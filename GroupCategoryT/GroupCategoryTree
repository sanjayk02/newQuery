const GroupCategoryTree: React.FC<GroupCategoryTreeProps> = ({
  categories,
  onRemoveGroup,
}) => {
  const classes = useStyles();

  // Build tree nodes from categories + groups
  const tree = useMemo(
    () => buildTreeFromCategories(categories),
    [categories],
  );

  const renderNodes = (
    nodes: TreeNode[],
    depth = 0,
    isLastArray: boolean[] = [],
  ): React.ReactNode =>
    nodes.map((node, index) => {
      const isLast = index === nodes.length - 1;
      const thisIsLastArray = [...isLastArray, isLast];

      // Build the ASCII prefix EXACTLY like your original:
      // e.g. "│  ├─ ", "│  └─ "
      let prefix = '';
      if (depth > 0) {
        for (let i = 0; i < depth - 1; i++) {
          prefix += thisIsLastArray[i] ? '   ' : '│  ';
        }
        prefix += isLast ? '└─ ' : '├─ ';
      }

      const isLeafGroup =
        node.isGroup &&
        node.category &&
        (!node.children || node.children.length === 0);

      return (
        <React.Fragment key={node.fullPath}>
          <div className={classes.treeRow}>
            {/* Left: plain ASCII tree text */}
            <span className={classes.treeText}>
              {prefix}
              {node.name}
            </span>

            {/* Spacer so icon sits on the far right */}
            {isLeafGroup && <div style={{ flex: 1 }} />}

            {/* Right: tiny delete icon, only for leaf groups */}
            {isLeafGroup && onRemoveGroup && (
              <IconButton
                size="small"
                style={{ padding: 4 }}
                onClick={() => onRemoveGroup(node.category!, node.fullPath)}
              >
                <DeleteIcon fontSize="small" />
              </IconButton>
            )}
          </div>

          {/* Children */}
          {renderNodes(node.children, depth + 1, thisIsLastArray)}
        </React.Fragment>
      );
    });

  return <div>{renderNodes(tree)}</div>;
};
