function buildCellStyle(
  col: Column,
  phaseMeta: Record<string, { start: string; end: string }>,
  opts: { header?: boolean; isGroupRow?: boolean } = {}
): React.CSSProperties {
  const { header = false, isGroupRow = false } = opts;

  const meta = col.phase ? phaseMeta[col.phase] : null;
  const isPhaseStart = !!(meta && meta.start === col.id);
  const isPhaseEnd = !!(meta && meta.end === col.id);

  const phaseCfg = col.phase ? COLORS.PHASE[col.phase] : null;
  const edgeColor = col.phase ? phaseCfg!.lineColor : COLORS.COL_EDGE;
  const headerBg = col.phase ? phaseCfg!.backgroundColor : COLORS.HEADER_BG;

  const paddingX = col.id === "group_1_name" ? UI.NAME_PAD_X : col.id === "thumbnail" ? UI.THUMB_PAD_X : UI.ROW_PAD_X;

  const style: React.CSSProperties = {
    backgroundColor: header ? headerBg : COLORS.ROW_BG,
    color: header ? "#fff" : COLORS.TEXT,
    whiteSpace: "nowrap",
    overflow: "hidden",
    textOverflow: "ellipsis",
    height: UI.ROW_HEIGHT,
    padding: `${header ? 2 : UI.ROW_PAD_Y}px ${paddingX}px`,
    fontSize: header ? UI.FONT_SIZE_HEADER : UI.FONT_SIZE_CONTENT,
    fontWeight: header ? 500 : 300,
    borderLeft: "0px",
    borderRight: "0px",
    borderBottom: header
      ? "1px solid " + COLORS.HEADER_BORDER
      : (isGroupRow ? UI.GROUP_ROW_GAP_PX : UI.ROW_GAP_PX) + "px solid " + COLORS.TABLE_BG,
  };

  // MODIFIED: Remove or reduce box shadows for inner phase columns
  const shadows: string[] = [];
  
  if (header) {
    // Only apply top/bottom shadows for phase columns (remove side shadows for inner columns)
    if (isPhaseStart) {
      shadows.push(`inset ${UI.RAIL_PX}px 0 0 0 ${edgeColor}`);
    }
    if (isPhaseEnd) {
      shadows.push(`inset -${UI.RAIL_PX}px 0 0 0 ${edgeColor}`);
    }
    // Keep top/bottom edges only
    shadows.push(`inset 0 ${UI.COL_EDGE_PX}px 0 0 ${edgeColor}`);
    shadows.push(`inset 0 -${UI.COL_EDGE_PX}px 0 0 ${edgeColor}`);
  }

  if (col.phase) {
    const rail = phaseCfg!.lineColor;
    // MODIFIED: Only apply rail to start/end of phase group, not between work/appr/submitted
    if (isPhaseStart) {
      style.borderLeft = `${UI.RAIL_PX}px solid ${rail}`;
    }
    if (isPhaseEnd) {
      style.borderRight = `${UI.RAIL_PX}px solid ${rail}`;
    }
    
    // For inner columns (like APPR between WORK and SUBMITTED), remove side borders
    if (!isPhaseStart && !isPhaseEnd) {
      style.borderLeft = "none";
      style.borderRight = "none";
    }
    
    style.borderRight = "0px solid " + COLORS.TABLE_BG;
  } else {
    if (col.id === "thumbnail") style.borderRight = "0px";
    else style.borderRight = "0px solid " + (header ? COLORS.HEADER_BORDER : COLORS.GRID_LINE);
  }

  if (shadows.length) style.boxShadow = shadows.join(", ");
  return style;
}
