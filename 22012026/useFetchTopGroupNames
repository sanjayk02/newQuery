export function useFetchTopGroupNames(
  project: Project | null | undefined,
) {
  const [topGroupNames, setTopGroupNames] = useState<string[]>([]);

  useEffect(() => {
    if (!project || !project.key_name) return;

    const controller = new AbortController();
    let isMounted = true;

    (async () => {
      try {
        const res = await fetchAssetsPivot(
          project.key_name,
          0,
          100,          // NEVER more than this
          'asc',
          'none',
          '',
          [],
          [],
          'grouped',
          controller.signal,
        );

        if (!isMounted) return;

        const groups = (res as any)?.groups || [];
        const names = Array.from(
          new Set(
            groups
              .map((g: any) => g.top_group_node)
              .filter(Boolean)
          )
        );

        setTopGroupNames(names);
      } catch (err: any) {
        if (err?.name === 'AbortError') {
          // normal cancellation, ignore
          return;
        }
        console.error('useFetchTopGroupNames error:', err);
      }
    })();

    return () => {
      isMounted = false;
      controller.abort();
    };
  }, [project]);

  return { topGroupNames };
}
