export function useFetchAssetsPivot(
  project: Project | null | undefined,
  page: number,
  rowsPerPage: number,
  sortKey: string,
  sortDir: SortDir,
  phase: string,
  // NEW (your params)
  nameKey2: string,
  workStatuses: string[] = [],
  apprStatuses: string[] = [],
): { assets: AssetPhaseSummary[]; total: number } {
  const [assets, setAssets] = useState<AssetPhaseSummary[]>([]);
  const [total, setTotal] = useState(0);

  useEffect(() => {
    if (project == null) return;
    if (sortDir === 'none') return;

    const controller = new AbortController();
    (async () => {
      try {
        const res = await fetchAssetsPivot(
          project.key_name,
          page,
          rowsPerPage,
          sortKey,
          sortDir,
          phase,
          controller.signal,
          {
            // âœ… use nameKey2 here
            ...(nameKey2?.trim() ? { name: nameKey2.trim(), name_mode: 'prefix' } : {}),
            ...(workStatuses.length ? { work: workStatuses.join(',') } : {}),
            ...(apprStatuses.length ? { appr: apprStatuses.join(',') } : {}),
          }
        );

        const list  = (res as any)?.assets ?? (res as any)?.data ?? [];
        const count = (res as any)?.total  ?? 0;
        setAssets(list);
        setTotal(count);
      } catch (err) {
        if (controller.signal.aborted) return;
        console.error(err);
      }
    })();

    // include joined arrays so deps are stable
    return () => controller.abort();
  }, [
    project,
    page,
    rowsPerPage,
    sortKey,
    sortDir,
    phase,
    nameKey2,
    workStatuses.join(','),
    apprStatuses.join(','),
  ]);

  return { assets, total };
}
