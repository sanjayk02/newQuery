WITH latest_phase AS (
    SELECT
        ri.project,
        ri.root,
        ri.group_1,
        ri.relation,
        ri.phase,
        ri.work_status,
        ri.approval_status,
        ri.submitted_at_utc,
        ri.modified_at_utc,

        ROW_NUMBER() OVER (
            PARTITION BY
                ri.project,
                ri.root,
                ri.group_1,
                ri.relation
            ORDER BY
                CASE
                    WHEN ri.phase IS NULL OR ri.phase = '' THEN 0
                    ELSE 1
                END DESC,
                ri.modified_at_utc DESC
        ) AS rn
    FROM t_review_info ri
    WHERE ri.project = ?
      AND ri.root = ?
      AND ri.deleted = 0
      /* + nameCond */
)
SELECT COUNT(*) AS total_count
FROM latest_phase
WHERE rn = 1
/* + statusWhere */;
